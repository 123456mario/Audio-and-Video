# 📘 통합 시스템 복구 및 명령어 매뉴얼

## 1. "정상 작동" 확정 파일 (Golden Standard File)
현재 가장 안정적이고 검증된 "Safe" 버전의 브릿지 스크립트는 다음과 같습니다:
*   **파일명:** `final_wing_bridge_v5_safe.py`
*   **위치:** `/home/pi/behringer-mixer/` (라즈베리 파이 내부)
*   **핵심 기능:**
    *   **제어 포트:** TCP 10025 (Xilica 제어 수신)
    *   **피드백 포트:** UDP 33901 (Wing 상태 수신)
    *   **로직:** 뮤트/언뮤트 및 볼륨 스케일링 (0-10 단계를 dB로 변환).
    *   **안전장치:** 무한 피드백 루프(에코) 방지 로직 포함.

---

## 2. 터미널 명령어 기록 및 설명 (명령어 모음집)

이번 트러블슈팅 과정에서 사용한 명령어들입니다. 나중에 문제가 생겼을 때 이 명령어들을 "공구함"처럼 꺼내 쓰시면 됩니다.

### 📡 연결 및 배포 (Connection & Deployment)
| 명령어 | 설명 |
| :--- | :--- |
| `ping -c 3 192.168.1.50` | **생존 확인:** 라즈베리 파이가 네트워크에 살아있는지 확인합니다. |
| `scp local_file.py pi@192.168.1.50:~/path/` | **파일 전송:** Mac에 있는 파일을 라즈베리 파이로 복사합니다. (기존 파일을 덮어씁니다.) |
| `ssh pi@192.168.1.50 'command'` | **원격 제어:** 라즈베리 파이에 접속하지 않고도 명령을 실행시킵니다. |

### 🛠️ 프로세스 관리 (Process Management)
| 명령어 | 설명 |
| :--- | :--- |
| `ps aux | grep python` | **범인 찾기:** 현재 파이에서 실행 중인 모든 파이썬 프로그램을 보여줍니다. |
| `sudo fuser -k -9 10025/tcp` | **포트 강제 청소:** 10025번 포트를 붙잡고 있는 프로세스를 **강제로 죽입니다.** ("Address already in use" 에러 해결사) |
| `pkill -f python` | **일괄 종료:** 실행 중인 모든 파이썬 스크립트를 종료합니다. (주의해서 사용) |
| `nohup python3 script.py &` | **무중단 실행:** SSH 연결을 끊어도 프로그램이 계속 돌아가도록 백그라운드에서 실행합니다. |

### 🔍 진단 및 디버깅 (Diagnostics & Debugging)
| 명령어 | 설명 |
| :--- | :--- |
| `nc -zv 192.168.1.50 10025` | **포트 확인:** 10025번 포트가 열려있는지(Listening) 확인합니다. 거부(Refused)되면 브릿지가 꺼진 것입니다. |
| `tail -n 50 log.txt` | **로그 읽기:** 로그 파일의 마지막 50줄을 보여줍니다. 방금 무슨 일이 있었는지 확인할 때 필수입니다. |
| `sudo tcpdump -i any port 10025` | **도청 (기초):** 10025번 포트로 오고 가는 신호만 잡아냅니다. |
| `sudo tcpdump -i any -n -A src 192.168.1.20` | **도청 (심화):** Xilica(192.168.1.20)에서 날아오는 **모든 신호**를 다 잡아냅니다. 포트가 달라도 다 찾아내는 "진실의 거울"입니다. |

---

## 3. 장비별 문제 해결 가이드 (Component Troubleshooting)

### 🎚️ Behringer Wing (오디오)
*   **통신 경로:** Xilica (TCP 10025) -> Pi -> Wing (UDP 2223).
*   **핵심 파일:** `final_wing_bridge_v5_safe.py`
*   **자주 겪는 문제:** "뮤트는 되는데, 볼륨만 안 돼요!"
    *   **해결책 1:** Xilica Designer 확인. 볼륨 페이더가 **문자열(String)** 형식으로 `set mvol -10` 명령을 보내는지, 그리고 **TCP** 방식인지 확인하세요. (UDP로 되어 있으면 안 됨)
    *   **해결책 2:** "Address already in use" 에러가 뜨면 `sudo fuser -k -9 10025/tcp` 명령을 날리세요.

### 📷 PTZ 카메라 (비디오)
*   **통신 경로:** Xilica (TCP) -> Pi -> Camera (VISCA/UDP 52381 또는 HTTP).
*   **관련 파일:** `ptz_cam.py` (수정 기록에서 확인됨).
*   **팁:**
    *   카메라 제어는 보통 UDP를 씁니다. 만약 움직임이 뚝뚝 끊기면 네트워크 대역폭을 확인하세요.
    *   Xilica에서는 단순히 "프리셋 리콜" 명령만 보내고, 파이(Pi)가 이를 복잡한 VISCA 명령(`81 01 ...`)으로 변환해주는 방식이 좋습니다.

### 💡 조명 (DMX/ArtNet)
*   **통신 경로:** Xilica (UDP) -> Pi -> ArtNet Node -> DMX Lights.
*   **팁:**
    *   조명 제어는 거의 항상 **UDP Broadcast** 방식을 씁니다.
    *   조명이 깜빡거린다면 네트워크 충돌(Collision)이 없는지 확인하세요.
    *   라즈베리 파이와 ArtNet 노드가 같은 네트워크 대역(Subnet)에 있는지 꼭 확인해야 합니다.

### 🖥️ Novastar (전광판)
*   **통신 경로:** Xilica (TCP/UDP) -> Pi -> Novastar Controller (TCP 5200 또는 UDP).
*   **핵심:** Novastar는 독자적인 Hex 프로토콜(`55 AA 00 ...`)을 사용합니다.
*   **팁:**
    *   Novastar 컨트롤러는 **5200번 포트** 연결에 아주 민감합니다.
    *   연결이 자꾸 끊기면, Novastar 장비의 랜선을 뺐다 꽂아보는(하드웨어 리셋) 것이 가장 빠를 때가 많습니다.
    *   연결을 유지하려면 주기적으로 "살아있니?" 신호(KeepAlive)를 보내줘야 할 수도 있습니다.

---

## 4. 맺음말 (Final Words)
이 문서는 고객님을 위한 "야전 교범"입니다. 뭔가 작동하지 않을 때는 당황하지 말고 순서대로 해보세요:
1.  **Ping**을 날려서 연결 확인.
2.  **포트 확인(`nc`)** 으로 프로그램이 켜져 있는지 확인.
3.  **로그 확인(`tail`)** 으로 무슨 에러가 떴는지 확인.
4.  **도청(`tcpdump`)** 으로 Xilica가 진짜 신호를 보내고 있는지 확인.
